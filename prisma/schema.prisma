
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model activity_logs {
  id         BigInt   @id @default(autoincrement())
  user_id    BigInt?
  action     String?
  target_type String?
  target_id  BigInt?
  metadata   Json?
  options    String?
  created_at DateTime? @default(now())

  users users? @relation(fields: [user_id], references: [id])
}

model companies {
  id                 BigInt @id @default(autoincrement())
  name               String
  contact_email      String?
  created_at         DateTime? @default(now())
  updated_at         DateTime? @default(now())
  status             Boolean @default(true)
  deleted_at         DateTime?

  users              users[]
  locations          locations[]
  location_types     location_types[]
  facility_companies facility_companies[]
  registered_users   registered_users[]
  shifts             shifts[]
  cleaner_review     cleaner_review[] @relation("CompanyReviews")
  user_review        user_review[]
}

model users {
  id                  BigInt @id @default(autoincrement())
  name                String
  email               String? @unique
  password            String?
  phone               String? @unique
  company_id          BigInt?
  role_id             Int?
  created_at          DateTime? @default(now())
  updated_at          DateTime? @default(now())

  companies companies? @relation(fields: [company_id], references: [id])
  role      Role?      @relation(fields: [role_id], references: [id])

  activity_logs     activity_logs[]
  sessions          sessions[]
  refresh_tokens    refresh_tokens[]
  saved_locations   saved_locations[]
  shift_assignments shift_assignments[]
  registered_users  registered_users[]
  cleaner_reviews   cleaner_review[] @relation("CleanerReviews")
  user_review       user_review[]
}

model registered_users {
  id         BigInt @id @default(autoincrement())
  user_id    BigInt
  role_id    Int?
  company_id BigInt?

  user    users    @relation(fields: [user_id], references: [id])
  role    Role?    @relation(fields: [role_id], references: [id])
  company companies? @relation(fields: [company_id], references: [id])
}

model user_review {
  id          BigInt @id @default(autoincrement())
  user_id     BigInt
  company_id  BigInt?
  location_id BigInt?
  rating      Int
  comment     String?
  created_at  DateTime @default(now())

  user     users      @relation(fields: [user_id], references: [id])
  company  companies? @relation(fields: [company_id], references: [id])
  location locations? @relation(fields: [location_id], references: [id])
}

model cleaner_review {
  id         BigInt @id @default(autoincrement())
  cleaner_id BigInt
  company_id BigInt?
  location_id BigInt?
  rating     Int
  comment    String?

  cleaner  users      @relation("CleanerReviews", fields: [cleaner_id], references: [id])
  company  companies? @relation("CompanyReviews", fields: [company_id], references: [id])
  location locations? @relation(fields: [location_id], references: [id])
}

model locations {
  id         BigInt @id @default(autoincrement())
  name       String
  company_id BigInt?

  company companies? @relation(fields: [company_id], references: [id])

  user_review user_review[]
}

model location_types {
  id         BigInt @id @default(autoincrement())
  name       String
  company_id BigInt?

  company companies? @relation(fields: [company_id], references: [id])
  locations locations[]
}

model facility_companies {
  id         BigInt @id @default(autoincrement())
  name       String
  company_id BigInt

  company   companies @relation(fields: [company_id], references: [id])
}

model shifts {
  id         BigInt @id @default(autoincrement())
  name       String?
  company_id BigInt?

  company companies? @relation(fields: [company_id], references: [id])
  assignments shift_assignments[]
}

model shift_assignments {
  id      BigInt @id @default(autoincrement())
  shiftId BigInt
  user_id BigInt

  shift shifts @relation(fields: [shiftId], references: [id])
  user  users  @relation(fields: [user_id], references: [id])
}

model Role {
  id          Int @id @default(autoincrement())
  name        String @unique
  permissions String[]

  users            users[]
  registered_users registered_users[]
  shiftAssignments shift_assignments[]
}

model sessions {
  id      BigInt @id @default(autoincrement())
  user_id BigInt
  token   String @unique

  user users @relation(fields: [user_id], references: [id])
}

model refresh_tokens {
  id      BigInt @id @default(autoincrement())
  user_id BigInt
  token   String @unique

  user users @relation(fields: [user_id], references: [id])
}

model saved_locations {
  id          BigInt @id @default(autoincrement())
  user_id     BigInt
  location_id BigInt

  user     users     @relation(fields: [user_id], references: [id])
  location locations @relation(fields: [location_id], references: [id])

  @@unique([user_id, location_id])
}
